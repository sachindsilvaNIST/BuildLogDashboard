<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BuildLogDashboard.ViewModels"
        xmlns:m="using:BuildLogDashboard.Models"
        xmlns:md="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="BuildLogDashboard.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Android OS Image Build Log Dashboard"
        Width="1400" Height="900"
        MinWidth="1400" MinHeight="900"
        MaxWidth="1400" MaxHeight="900"
        CanResize="False"
        Background="{StaticResource GlassBackgroundBrush}">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Panel>
    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Toolbar -->
        <Border Grid.Row="0"
                Background="{StaticResource GlassPanelTranslucentBrush}"
                BorderBrush="{StaticResource GlassBorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="12,8">
            <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                <!-- Left toolbar buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <Button Command="{Binding OpenFolderCommand}"
                            ToolTip.Tip="Open Workspace Folder"
                            Padding="12,8"
                            Classes="btn-light-gray"
                            Background="{StaticResource GlassAppleLightGrayBrush}"
                            Foreground="#333333"
                            IsVisible="{Binding HasWorkspaceLoaded}">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <PathIcon Data="M2 6C2 4.89543 2.89543 4 4 4H9L11 6H20C21.1046 6 22 6.89543 22 8V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18V6Z"
                                      Width="16" Height="16" Foreground="#333333"/>
                            <TextBlock Text="Open Folder" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding NewBuildCommand}"
                            ToolTip.Tip="Create New Build Log"
                            Padding="12,8"
                            Classes="btn-green"
                            Background="{StaticResource GlassAppleGreenBrush}"
                            Foreground="White"
                            IsEnabled="{Binding HasWorkspaceLoaded}">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <PathIcon Data="M12 4V20M4 12H20" Width="16" Height="16" Foreground="White"/>
                            <TextBlock Text="New Build" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding SaveBuildCommand}"
                            ToolTip.Tip="Save Current Build"
                            Padding="12,8"
                            Classes="btn-save"
                            Background="{Binding IsSaved, Converter={StaticResource SaveButtonBackgroundConverter}}"
                            Foreground="White"
                            IsEnabled="{Binding HasWorkspaceLoaded}">
                        <Panel>
                            <!-- Unsaved state: Save icon + "Save" -->
                            <StackPanel Orientation="Horizontal" Spacing="6"
                                        IsVisible="{Binding IsSaved, Converter={StaticResource InverseBoolConverter}}">
                                <PathIcon Data="M17 3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V7L17 3ZM19 19H5V5H16.17L19 7.83V19ZM12 12C10.34 12 9 13.34 9 15S10.34 18 12 18 15 16.66 15 15 13.66 12 12 12ZM6 6H15V10H6V6Z"
                                          Width="16" Height="16" Foreground="White"/>
                                <TextBlock Text="Save" VerticalAlignment="Center"/>
                            </StackPanel>
                            <!-- Saved state: Checkmark + "Saved" -->
                            <StackPanel Orientation="Horizontal" Spacing="6"
                                        IsVisible="{Binding IsSaved}">
                                <PathIcon Data="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"
                                          Width="16" Height="16" Foreground="White"/>
                                <TextBlock Text="Saved" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Panel>
                    </Button>

                    <Rectangle Width="1" Fill="{StaticResource GlassBorderBrush}" Margin="8,4"/>

                    <Button Command="{Binding ImportMarkdownCommand}"
                            ToolTip.Tip="Import Markdown File"
                            Padding="12,8"
                            Classes="btn-red"
                            Background="{StaticResource GlassAppleRedBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <PathIcon Data="M5 20H19V18H5V20ZM19 9H15V3H9V9H5L12 16L19 9Z" Width="16" Height="16" Foreground="White"/>
                            <TextBlock Text="Import" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button ToolTip.Tip="Export Build Log"
                            Padding="12,8"
                            Classes="btn-success"
                            Background="{StaticResource GlassSuccessBrush}"
                            Foreground="White"
                            IsEnabled="{Binding HasWorkspaceLoaded}">
                        <Button.Flyout>
                            <MenuFlyout Placement="Bottom">
                                <MenuItem Header="Export as Markdown (.md)" Command="{Binding ExportMarkdownCommand}">
                                    <MenuItem.Icon>
                                        <PathIcon Data="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM16 18H8V16H16V18ZM16 14H8V12H16V14ZM13 9V3.5L18.5 9H13Z" Width="14" Height="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Export as HTML (.html)" Command="{Binding ExportHtmlCommand}">
                                    <MenuItem.Icon>
                                        <PathIcon Data="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z" Width="14" Height="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Export as PDF (.pdf)" Command="{Binding ExportPdfCommand}">
                                    <MenuItem.Icon>
                                        <PathIcon Data="M20 2H8C6.9 2 6 2.9 6 4V16C6 17.1 6.9 18 8 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H8V4H20V16ZM4 6H2V20C2 21.1 2.9 22 4 22H18V20H4V6ZM16 12V9C16 8.45 15.55 8 15 8H13V13H15C15.55 13 16 12.55 16 12ZM14 9H15V12H14V9ZM18 11H17V10H18V9H17V8H19V13H17V11Z" Width="14" Height="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </MenuFlyout>
                        </Button.Flyout>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <PathIcon Data="M9 16H15V10H19L12 3L5 10H9V16ZM5 18H19V20H5V18Z" Width="16" Height="16" Foreground="White"/>
                            <TextBlock Text="Export" VerticalAlignment="Center"/>
                            <PathIcon Data="M7 10L12 15L17 10H7Z" Width="10" Height="10" Foreground="White"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Workspace path -->
                <Border Grid.Column="1"
                        Background="{StaticResource GlassPanelBrush}"
                        BorderBrush="{StaticResource GlassBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="8,4"
                        Margin="16,0,0,0"
                        IsVisible="{Binding WorkspacePath, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <TextBlock Text="{Binding WorkspacePath}"
                               Foreground="{StaticResource GlassSubtleTextBrush}"
                               FontSize="12"
                               MaxWidth="300"
                               TextTrimming="CharacterEllipsis"/>
                </Border>

                <!-- Right toolbar buttons -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8"
                            IsVisible="{Binding HasWorkspaceLoaded}">
                    <Button Command="{Binding TogglePreviewCommand}"
                            ToolTip.Tip="Toggle Preview Panel"
                            Padding="12,8"
                            Background="{Binding IsPreviewVisible, Converter={StaticResource BoolToBrushConverter}}"
                            Foreground="{Binding IsPreviewVisible, Converter={StaticResource BoolToForegroundConverter}}">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <PathIcon Data="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5S21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7 17 9.24 17 12 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12S10.34 15 12 15 15 13.66 15 12 13.66 9 12 9Z"
                                      Width="16" Height="16" Foreground="{Binding $parent[Button].Foreground}"/>
                            <TextBlock Text="Preview" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Welcome Panel (shown when no workspace loaded) -->
        <Border Grid.Row="1"
                IsVisible="{Binding !HasWorkspaceLoaded}"
                Background="{StaticResource GlassBackgroundBrush}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="24">
                <PathIcon Data="M2 6C2 4.89543 2.89543 4 4 4H9L11 6H20C21.1046 6 22 6.89543 22 8V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18V6Z"
                          Width="80" Height="80" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                <TextBlock Text="Welcome to Build Log Dashboard"
                           FontSize="28"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource GlassTextBrush}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="Click 'Open Folder' to load an Android image workspace&#x0a;or 'Import' to load an existing markdown build log."
                           FontSize="14"
                           Foreground="{StaticResource GlassSubtleTextBrush}"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           LineHeight="22"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="16" Margin="0,16,0,0">
                    <Button Command="{Binding OpenFolderCommand}"
                            Padding="20,12"
                            Classes="btn-light-gray"
                            Background="{StaticResource GlassAppleLightGrayBrush}"
                            Foreground="#333333">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M2 6C2 4.89543 2.89543 4 4 4H9L11 6H20C21.1046 6 22 6.89543 22 8V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18V6Z"
                                      Width="18" Height="18" Foreground="#333333"/>
                            <TextBlock Text="Open Folder" VerticalAlignment="Center" FontSize="14"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ImportMarkdownCommand}"
                            Padding="20,12"
                            Classes="btn-red"
                            Background="{StaticResource GlassAppleRedBrush}"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Data="M5 20H19V18H5V20ZM19 9H15V3H9V9H5L12 16L19 9Z" Width="18" Height="18" Foreground="White"/>
                            <TextBlock Text="Import Markdown" VerticalAlignment="Center" FontSize="14"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Main Content (shown when workspace loaded) -->
        <Grid Grid.Row="1" ColumnDefinitions="280,*" IsVisible="{Binding HasWorkspaceLoaded}">

            <!-- Build List Sidebar -->
            <Border Grid.Column="0"
                    Background="{StaticResource GlassPanelTranslucentBrush}"
                    BorderBrush="{StaticResource GlassBorderBrush}"
                    BorderThickness="0,0,1,0"
                    Padding="12">
                <Grid RowDefinitions="Auto,Auto,*">
                    <TextBlock Grid.Row="0"
                               Text="Builds"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <!-- Search Box -->
                    <TextBox Grid.Row="1"
                             Text="{Binding SearchText}"
                             Watermark="Search builds..."
                             Margin="0,0,0,12"
                             CornerRadius="4"/>

                    <!-- Build List -->
                    <ListBox Grid.Row="2"
                             ItemsSource="{Binding Builds}"
                             SelectedItem="{Binding SelectedBuild}"
                             Background="Transparent"
                             BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="m:BuildProject">
                                <Border Background="{StaticResource GlassPanelBrush}"
                                        BorderBrush="{StaticResource GlassBorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        Padding="12"
                                        Margin="0,0,0,8">
                                    <Grid RowDefinitions="Auto,Auto,Auto">
                                        <TextBlock Grid.Row="0"
                                                   Text="{Binding BuildNumber}"
                                                   FontWeight="SemiBold"
                                                   FontSize="14"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Grid.Row="1"
                                                   Text="{Binding Device}"
                                                   Foreground="{StaticResource GlassSubtleTextBrush}"
                                                   FontSize="12"
                                                   Margin="0,4,0,0"/>
                                        <TextBlock Grid.Row="2"
                                                   Text="{Binding BuildDate, StringFormat={}{0:yyyy-MM-dd}}"
                                                   Foreground="{StaticResource GlassSubtleTextBrush}"
                                                   FontSize="11"
                                                   Margin="0,2,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Editor Area -->
            <Grid Grid.Column="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="{Binding IsPreviewVisible, Converter={StaticResource BoolToGridLengthConverter}}"/>
                </Grid.ColumnDefinitions>

                <!-- Editor Tabs -->
                <Border Grid.Column="0" Padding="16">
                    <TabControl SelectedIndex="{Binding SelectedTabIndex}">

                        <!-- Build Info Tab -->
                        <TabItem Header="Build Info">
                            <ScrollViewer>
                                <StackPanel Spacing="16" Margin="0,16,0,0">
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                                              ColumnDefinitions="150,*,32,150,*">

                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Build Number" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedBuild.BuildNumber}" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="0" Grid.Column="3" Text="Build Date" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <CalendarDatePicker Grid.Row="0" Grid.Column="4" SelectedDate="{Binding SelectedBuild.BuildDate}" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Device" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedBuild.Device}" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="1" Grid.Column="3" Text="Build Type" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <ComboBox Grid.Row="1" Grid.Column="4" SelectedItem="{Binding SelectedBuild.BuildType}" Margin="0,0,0,12">
                                                <ComboBoxItem Content="user"/>
                                                <ComboBoxItem Content="userdebug"/>
                                                <ComboBoxItem Content="eng"/>
                                            </ComboBox>

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Android Version" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedBuild.AndroidVersion}" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="2" Grid.Column="3" Text="Security Patch" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <TextBox Grid.Row="2" Grid.Column="4" Text="{Binding SelectedBuild.SecurityPatch}" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Kernel Version" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedBuild.KernelVersion}" Margin="0,0,0,12"/>

                                            <TextBlock Grid.Row="3" Grid.Column="3" Text="Previous Build" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                            <TextBox Grid.Row="3" Grid.Column="4" Text="{Binding SelectedBuild.PreviousBuild}" Margin="0,0,0,12"/>
                                        </Grid>
                                    </Border>

                                    <!-- Files Section -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <Grid ColumnDefinitions="*,Auto">
                                                <TextBlock Grid.Column="0" Text="Files" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                                <Button Grid.Column="1" Command="{Binding ComputeChecksumsCommand}" Content="Compute SHA256" Margin="0,0,0,12" Padding="12,6"/>
                                            </Grid>
                                            <DataGrid ItemsSource="{Binding SelectedBuild.Files}"
                                                      AutoGenerateColumns="False"
                                                      CanUserReorderColumns="False"
                                                      CanUserResizeColumns="True"
                                                      GridLinesVisibility="Horizontal"
                                                      BorderThickness="1"
                                                      BorderBrush="{StaticResource GlassBorderBrush}"
                                                      CornerRadius="4"
                                                      IsReadOnly="True">
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="*"/>
                                                    <DataGridTextColumn Header="Size" Binding="{Binding FileSize}" Width="120"/>
                                                    <DataGridTextColumn Header="SHA256" Binding="{Binding Sha256}" Width="*"/>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Changelog Tab -->
                        <TabItem Header="Changelog">
                            <ScrollViewer>
                                <StackPanel Spacing="16" Margin="0,16,0,0">
                                    <!-- App Updates -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <Grid ColumnDefinitions="*,Auto">
                                                <TextBlock Grid.Column="0" Text="App Updates" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                                <Button Grid.Column="1" Command="{Binding AddAppUpdateCommand}" Content="+ Add App" Margin="0,0,0,12" Padding="12,6"/>
                                            </Grid>
                                            <DataGrid ItemsSource="{Binding SelectedBuild.AppUpdates}"
                                                      AutoGenerateColumns="False"
                                                      CanUserReorderColumns="False"
                                                      CanUserResizeColumns="True"
                                                      GridLinesVisibility="Horizontal"
                                                      BorderThickness="1"
                                                      BorderBrush="{StaticResource GlassBorderBrush}"
                                                      CornerRadius="4"
                                                      MaxHeight="250">
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="App Name" Binding="{Binding AppName}" Width="150"/>
                                                    <DataGridTextColumn Header="Path" Binding="{Binding Path}" Width="*"/>
                                                    <DataGridTextColumn Header="Version" Binding="{Binding Version}" Width="80"/>
                                                    <DataGridTextColumn Header="Changes" Binding="{Binding Changes}" Width="*"/>
                                                    <DataGridTemplateColumn Header="" Width="40">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Button Command="{Binding $parent[DataGrid].((vm:MainWindowViewModel)DataContext).RemoveAppUpdateCommand}"
                                                                        CommandParameter="{Binding}"
                                                                        Content="X"
                                                                        Padding="4"
                                                                        Background="Transparent"
                                                                        Foreground="{StaticResource GlassErrorColor}"/>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                        </StackPanel>
                                    </Border>

                                    <!-- System Modifications -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="System Modifications" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                            <TextBlock Text="Enter each modification on a new line" FontSize="12" Foreground="{StaticResource GlassSubtleTextBrush}" Margin="0,0,0,8"/>
                                            <TextBox Text="{Binding SelectedBuild.SystemModifications}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     Height="100"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Kernel/Driver Changes -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Kernel/Driver Changes" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                            <TextBox Text="{Binding SelectedBuild.KernelDriverChanges}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     Height="100"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Configuration Changes -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Configuration Changes" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                            <TextBox Text="{Binding SelectedBuild.ConfigurationChanges}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     Height="100"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Removed Components -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Removed Components" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                            <TextBox Text="{Binding SelectedBuild.RemovedComponents}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     Height="100"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Known Issues Tab -->
                        <TabItem Header="Issues">
                            <ScrollViewer>
                                <Border Background="{StaticResource GlassPanelBrush}"
                                        BorderBrush="{StaticResource GlassBorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Padding="20"
                                        Margin="0,16,0,0">
                                    <StackPanel>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBlock Grid.Column="0" Text="Known Issues" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <Button Grid.Column="1" Command="{Binding AddKnownIssueCommand}" Content="+ Add Issue" Margin="0,0,0,12" Padding="12,6"/>
                                        </Grid>
                                        <DataGrid ItemsSource="{Binding SelectedBuild.KnownIssues}"
                                                  AutoGenerateColumns="False"
                                                  CanUserReorderColumns="False"
                                                  CanUserResizeColumns="True"
                                                  GridLinesVisibility="Horizontal"
                                                  BorderThickness="1"
                                                  BorderBrush="{StaticResource GlassBorderBrush}"
                                                  CornerRadius="4">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Issue" Binding="{Binding Issue}" Width="*"/>
                                                <DataGridTemplateColumn Header="Severity" Width="100">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <ComboBox SelectedItem="{Binding Severity}" ItemsSource="{x:Static m:KnownIssue.SeverityOptions}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTemplateColumn Header="Status" Width="100">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <ComboBox SelectedItem="{Binding Status}" ItemsSource="{x:Static m:KnownIssue.StatusOptions}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTextColumn Header="Workaround" Binding="{Binding Workaround}" Width="*"/>
                                                <DataGridTemplateColumn Header="" Width="40">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button Command="{Binding $parent[DataGrid].((vm:MainWindowViewModel)DataContext).RemoveKnownIssueCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    Content="X"
                                                                    Padding="4"
                                                                    Background="Transparent"
                                                                    Foreground="{StaticResource GlassErrorColor}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Testing Tab -->
                        <TabItem Header="Testing">
                            <ScrollViewer>
                                <Border Background="{StaticResource GlassPanelBrush}"
                                        BorderBrush="{StaticResource GlassBorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Padding="20"
                                        Margin="0,16,0,0">
                                    <StackPanel>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBlock Grid.Column="0" Text="Testing Status" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <Button Grid.Column="1" Command="{Binding AddTestResultCommand}" Content="+ Add Test" Margin="0,0,0,12" Padding="12,6"/>
                                        </Grid>
                                        <DataGrid ItemsSource="{Binding SelectedBuild.TestResults}"
                                                  AutoGenerateColumns="False"
                                                  CanUserReorderColumns="False"
                                                  CanUserResizeColumns="True"
                                                  GridLinesVisibility="Horizontal"
                                                  BorderThickness="1"
                                                  BorderBrush="{StaticResource GlassBorderBrush}"
                                                  CornerRadius="4">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Test Name" Binding="{Binding TestName}" Width="*"/>
                                                <DataGridTemplateColumn Header="Result" Width="120">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <ComboBox SelectedItem="{Binding Result}" ItemsSource="{x:Static m:TestResult.ResultOptions}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                                <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
                                                <DataGridTemplateColumn Header="" Width="40">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button Command="{Binding $parent[DataGrid].((vm:MainWindowViewModel)DataContext).RemoveTestResultCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    Content="X"
                                                                    Padding="4"
                                                                    Background="Transparent"
                                                                    Foreground="{StaticResource GlassErrorColor}"/>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Release Tab -->
                        <TabItem Header="Release">
                            <ScrollViewer>
                                <StackPanel Spacing="16" Margin="0,16,0,0">
                                    <!-- Dependencies -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Dependencies" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="150,*">
                                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Bootloader Version" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedBuild.BootloaderVersion}" Margin="0,0,0,12"/>

                                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Compatible OTA" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedBuild.CompatibleOtaBuilds}"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- Recommended For -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Recommended For" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <CheckBox Content="Internal Testing" IsChecked="{Binding SelectedBuild.InternalTesting}" Margin="0,0,0,8"/>
                                            <CheckBox Content="Customer Release" IsChecked="{Binding SelectedBuild.CustomerRelease}" Margin="0,0,0,12"/>
                                            <Grid ColumnDefinitions="150,*">
                                                <TextBlock Grid.Column="0" Text="Specific Customer" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                                <TextBox Grid.Column="1" Text="{Binding SelectedBuild.SpecificCustomer}"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- Customer Release Notes -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Customer Release Notes" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                            <TextBox Text="{Binding SelectedBuild.CustomerReleaseNotes}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     Height="150"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Build Engineer -->
                                    <Border Background="{StaticResource GlassPanelBrush}"
                                            BorderBrush="{StaticResource GlassBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="20">
                                        <StackPanel>
                                            <TextBlock Text="Build Engineer" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="150,*">
                                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Built by" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedBuild.BuiltBy}" Margin="0,0,0,12"/>

                                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Reviewed by" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedBuild.ReviewedBy}" Margin="0,0,0,12"/>

                                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Approved Date" VerticalAlignment="Center" Foreground="{StaticResource GlassSubtleTextBrush}"/>
                                                <CalendarDatePicker Grid.Row="2" Grid.Column="1" SelectedDate="{Binding SelectedBuild.ApprovedForReleaseDate}"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>
                </Border>

                <!-- Preview Panel -->
                <Border Grid.Column="1"
                        IsVisible="{Binding IsPreviewVisible}"
                        Background="{StaticResource GlassPanelBrush}"
                        BorderBrush="{StaticResource GlassBorderBrush}"
                        BorderThickness="1,0,0,0">
                    <Grid RowDefinitions="Auto,*">
                        <Border Grid.Row="0"
                                Background="{StaticResource GlassBackgroundBrush}"
                                Padding="16,12">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="Markdown Preview" FontWeight="SemiBold"/>
                                <Button Grid.Column="1" Command="{Binding UpdatePreviewCommand}" Content="Refresh" Padding="8,4"/>
                            </Grid>
                        </Border>
                        <ScrollViewer Grid.Row="1" Padding="16" Background="#F5F5F5">
                            <Border Padding="32,40" Background="White" Margin="8" CornerRadius="4"
                                    BoxShadow="0 2 12 0 #20000000">
                                <md:MarkdownScrollViewer Markdown="{Binding PreviewContent}"
                                                         SaveScrollValueWhenContentUpdated="True"/>
                            </Border>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource GlassPanelTranslucentBrush}"
                BorderBrush="{StaticResource GlassBorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="16,8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <ProgressBar Grid.Column="0"
                             IsIndeterminate="{Binding IsBusy}"
                             IsVisible="{Binding IsBusy}"
                             Width="100"
                             Margin="0,0,16,0"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding StatusMessage}"
                           VerticalAlignment="Center"/>
                <TextBlock Grid.Column="2"
                           Text="{Binding SelectedBuild.LastUpdated, StringFormat='Last updated: {0:yyyy-MM-dd HH:mm}'}"
                           Foreground="{StaticResource GlassSubtleTextBrush}"
                           VerticalAlignment="Center"
                           IsVisible="{Binding HasWorkspaceLoaded}"/>
            </Grid>
        </Border>
    </Grid>

    <!-- Loading Overlay (Apple-style) -->
    <Border IsVisible="{Binding IsBusy}"
            Background="#80000000"
            ZIndex="1000">
        <Border HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Background="White"
                CornerRadius="16"
                Padding="40,32"
                BoxShadow="0 8 32 0 #40000000">
            <StackPanel Spacing="20" HorizontalAlignment="Center">
                <!-- Circular Spinner using Arc Path -->
                <Canvas Width="48" Height="48" HorizontalAlignment="Center">
                    <Path Canvas.Left="0" Canvas.Top="0"
                          Stroke="{StaticResource GlassBorderBrush}"
                          StrokeThickness="4"
                          Data="M 24,4 A 20,20 0 1 1 23.99,4"/>
                    <Path Canvas.Left="0" Canvas.Top="0"
                          Name="SpinnerArc"
                          Stroke="{StaticResource GlassAppleBlueBrush}"
                          StrokeThickness="4"
                          StrokeLineCap="Round"
                          Data="M 24,4 A 20,20 0 0 1 44,24"
                          RenderTransformOrigin="24,24">
                        <Path.Styles>
                            <Style Selector="Path#SpinnerArc">
                                <Style.Animations>
                                    <Animation Duration="0:0:1" IterationCount="Infinite">
                                        <KeyFrame Cue="0%">
                                            <Setter Property="RotateTransform.Angle" Value="0"/>
                                        </KeyFrame>
                                        <KeyFrame Cue="100%">
                                            <Setter Property="RotateTransform.Angle" Value="360"/>
                                        </KeyFrame>
                                    </Animation>
                                </Style.Animations>
                            </Style>
                        </Path.Styles>
                        <Path.RenderTransform>
                            <RotateTransform Angle="0"/>
                        </Path.RenderTransform>
                    </Path>
                </Canvas>
                <!-- Loading Message -->
                <TextBlock Text="{Binding BusyMessage}"
                           FontSize="15"
                           FontWeight="Medium"
                           Foreground="{StaticResource GlassTextBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Border>
    </Panel>
</Window>
